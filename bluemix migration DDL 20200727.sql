
DROP TABLE "UPES_UT"."ACCOUNT";
DROP TABLE "UPES_UT"."ACCOUNT_PERSON";
DROP TABLE "UPES_UT"."ACCOUNT_PERSON_HIST";
DROP TABLE "UPES_UT"."AUDIT" ;
DROP TABLE "UPES_UT"."CONTRACT";
DROP TABLE "UPES_UT"."COUNTRY";
DROP TABLE "UPES_UT"."DB2_ERRORS";
DROP TABLE "UPES_UT"."EMAIL_LOG";
DROP TABLE "UPES_UT"."PERSON";
DROP TABLE "UPES_UT"."PERSON_HIST";
DROP TABLE "UPES_UT"."PES_LEVELS";
DROP TABLE "UPES_UT"."TRACE";
DROP TABLE "UPES_UT"."TRACE_CONTROL";


CREATE TABLE "UPES_UT"."ACCOUNT" (
		"ACCOUNT_ID" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1000 INCREMENT BY 10 MINVALUE 1000 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		"ACCOUNT" CHAR(125) NOT NULL,
		"TASKID" CHAR(40)
	)
	IN USERSPACE1
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."ACCOUNT_PERSON" (
		"ACCOUNT_ID" INTEGER NOT NULL,
		"UPES_REF" INTEGER NOT NULL,
		"PES_LEVEL" CHAR(5),
		"PES_DATE_REQUESTED" DATE NOT NULL DEFAULT CURRENT DATE,
		"PES_REQUESTOR" CHAR(75) NOT NULL,
		"PES_STATUS" CHAR(50) NOT NULL DEFAULT 'Request Created',
		"PES_STATUS_DETAILS" CLOB(1048576),
		"PES_DATE_RESPONDED" DATE,
		"PES_EVIDENCE_DATE" DATE,
		"PES_CLEARED_DATE" DATE,
		"PES_RECHECK_DATE" DATE,
		"CONSENT" CHAR(10),
		"RIGHT_TO_WORK" CHAR(10),
		"PROOF_OF_ID" CHAR(10),
		"PROOF_OF_RESIDENCY" CHAR(10),
		"CREDIT_CHECK" CHAR(10),
		"FINANCIAL_SANCTIONS" CHAR(10),
		"CRIMINAL_RECORDS_CHECK" CHAR(10),
		"PROOF_OF_ACTIVITY" CHAR(10),
		"QUALIFICATIONS" CHAR(10),
		"DIRECTORS" CHAR(10),
		"MEDIA" CHAR(10),
		"MEMBERSHIP" CHAR(10),
		"PROCESSING_STATUS" CHAR(20),
		"PROCESSING_STATUS_CHANGED" TIMESTAMP,
		"DATE_LAST_CHASED" DATE,
		"COMMENT" VARCHAR(8192),
		"PRIORITY" CHAR(10),
		"COUNTRY_OF_RESIDENCE" CHAR(50),
		"NI_EVIDENCE" CHAR(10),
		SYS_START TIMESTAMP(12) NOT NULL GENERATED ALWAYS AS ROW BEGIN IMPLICITLY HIDDEN,
		SYS_END TIMESTAMP(12) NOT NULL GENERATED ALWAYS AS ROW END IMPLICITLY HIDDEN,
		CREATE_ID TIMESTAMP(12) GENERATED ALWAYS AS TRANSACTION START ID IMPLICITLY HIDDEN,
		PERIOD SYSTEM_TIME(sys_start,sys_end)
	)
	IN USERSPACE1
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."ACCOUNT_PERSON_HIST" LIKE "UPES_UT"."ACCOUNT_PERSON"; 
ALTER TABLE "UPES_UT"."ACCOUNT_PERSON" 
ADD VERSIONING USE HISTORY TABLE "UPES_UT"."ACCOUNT_PERSON_HIST" ;	
	



CREATE TABLE "UPES_UT"."AUDIT" (
		"TIMESTAMP" TIMESTAMP,
		"EMAIL_ADDRESS" CHAR(60),
		"DATA" CLOB(1048576),
		"TYPE" CHAR(20)
	)
	IN USERSPACE1	
	DATA CAPTURE NONE 
	VALUE COMPRESSION;

CREATE TABLE "UPES_UT"."CONTRACT" (
		"CONTRACT_ID" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 5 INCREMENT BY 5 MINVALUE 5 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		"ACCOUNT_ID" INTEGER NOT NULL DEFAULT 0,
		"CONTRACT" CHAR(50) NOT NULL DEFAULT 'contract'
	)
	IN USERSPACE1	
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."COUNTRY" (
		"COUNTRY" CHAR(50) NOT NULL,
		"EMAIL_BODY_NAME" CHAR(20) DEFAULT 'International',
		"ADDITIONAL_APPLICATION_FORM" CHAR(20)
	)
	IN USERSPACE1	
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."DB2_ERRORS" (
		"USERID" CHAR(50),
		"PAGE" VARCHAR(300),
		"DB2_ERROR" CHAR(50),
		"DB_MESSAGE" VARCHAR(512),
		"BACKTRACE" CLOB(1048576),
		"REQUEST" VARCHAR(1024),
		"TIMESTAMP" TIMESTAMP
	)
	IN USERSPACE1	
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."EMAIL_LOG" (
		"RECORD_ID" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		"TO" VARCHAR(512),
		"SUBJECT" VARCHAR(200),
		"MESSAGE" CLOB(262144),
		"DATA_JSON" CLOB(5242880),
		"RESPONSE" CLOB(10240),
		"LAST_STATUS" CLOB(1024),
		"SENT_TIMESTAMP" TIMESTAMP,
		"STATUS_TIMESTAMP" TIMESTAMP,
		"CC" CLOB(1048576),
		"BCC" CLOB(1048576)
	)
	IN USERSPACE1	
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."PERSON" (
		"UPES_REF" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 10000 INCREMENT BY 100 MINVALUE 10000 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		"CNUM" CHAR(9),
		"EMAIL_ADDRESS" CHAR(50),
		"FULL_NAME" VARCHAR(75) NOT NULL DEFAULT '',
		"PASSPORT_FIRST_NAME" CHAR(50),
		"PASSPORT_LAST_NAME" CHAR(50),
		"COUNTRY" CHAR(2) NOT NULL DEFAULT ' ',
		"IBM_STATUS" CHAR(30) DEFAULT ' ',
		"PES_DATE_ADDED" DATE NOT NULL DEFAULT CURRENT DATE,
		"PES_ADDER" CHAR(75) NOT NULL,
		"BLUEPAGES_STATUS" CHAR(20),
		SYS_START TIMESTAMP(12) NOT NULL GENERATED ALWAYS AS ROW BEGIN IMPLICITLY HIDDEN,
		SYS_END TIMESTAMP(12) NOT NULL GENERATED ALWAYS AS ROW END IMPLICITLY HIDDEN,
		CREATE_ID TIMESTAMP(12) GENERATED ALWAYS AS TRANSACTION START ID IMPLICITLY HIDDEN,
		PERIOD SYSTEM_TIME(sys_start,sys_end)
	)
	IN USERSPACE1	
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."PERSON_HIST" LIKE  "UPES_UT"."PERSON"; 
ALTER TABLE "UPES_UT"."PERSON" 
ADD VERSIONING USE HISTORY TABLE "UPES_UT"."PERSON_HIST" ;	


CREATE TABLE "UPES_UT"."PES_LEVELS" (
		"PES_LEVEL_REF" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		"ACCOUNT_ID" INTEGER,
		"PES_LEVEL" CHAR(25) NOT NULL,
		"PES_LEVEL_DESCRIPTION" VARCHAR(50),
		"RECHECK_YEARS" INTEGER
	)
	IN USERSPACE1	
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."TRACE" (
		"LOG_ENTRY" VARCHAR (32000) FOR BIT DATA NOT NULL,
		"LASTUPDATER" CHAR(50) NOT NULL,
		"LASTUPDATED" TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP,
		"CLASS" CHAR(50) DEFAULT NULL,
		"METHOD" CHAR(50) DEFAULT NULL,
		"PAGE" VARCHAR(200) DEFAULT NULL,
		"ELAPSED" DOUBLE DEFAULT NULL
	)
	IN USERSPACE1	
	DATA CAPTURE NONE;

CREATE TABLE "UPES_UT"."TRACE_CONTROL" (
		"TRACE_CONTROL_TYPE" CHAR(20),
		"TRACE_CONTROL_VALUE" CHAR(40)
	)
	IN USERSPACE1	
	DATA CAPTURE NONE 
	COMPRESS YES
	VALUE COMPRESSION;

CREATE UNIQUE INDEX "UPES_UT"."CountryIx"
	ON "UPES_UT"."COUNTRY"
	("COUNTRY"		ASC) PCTFREE 10
ALLOW REVERSE SCANS;

ALTER TABLE "UPES_UT"."ACCOUNT" ADD CONSTRAINT "ACC_ID_PK" PRIMARY KEY
	("ACCOUNT_ID");

ALTER TABLE "UPES_UT"."ACCOUNT" ADD CONSTRAINT "ACC_UNIQUE" UNIQUE
	("ACCOUNT");

ALTER TABLE "UPES_UT"."ACCOUNT_PERSON" ADD CONSTRAINT "AccPer_PK" PRIMARY KEY
	("ACCOUNT_ID",
	 "UPES_REF");

ALTER TABLE "UPES_UT"."CONTRACT" ADD CONSTRAINT "CON_ID_PK" PRIMARY KEY
	("CONTRACT_ID");

ALTER TABLE "UPES_UT"."PERSON" ADD CONSTRAINT "Per_PK" PRIMARY KEY
	("UPES_REF");

ALTER TABLE "UPES_UT"."CONTRACT" ADD CONSTRAINT "ACC_CON_FK" FOREIGN KEY
	("ACCOUNT_ID")
	REFERENCES "UPES_UT"."ACCOUNT"
	("ACCOUNT_ID")
	ON DELETE CASCADE;

ALTER TABLE "UPES_UT"."PES_LEVELS" ADD CONSTRAINT "ACC_ID_PES_LEV_FK" FOREIGN KEY
	("ACCOUNT_ID")
	REFERENCES "UPES_UT"."ACCOUNT"
	("ACCOUNT_ID")
	ON DELETE CASCADE;

